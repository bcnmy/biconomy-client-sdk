### Bundler

In the context of (ERC4337), A bundler plays a main role in the infrastructure. This concept is integral to the operation of account abstraction across any network that utilizes the Ethereum Virtual Machine (EVM).

## Installation

Using `npm` package manager

```bash
npm i @biconomy/bundler
```

OR

Using `yarn` package manager

```bash
yarn add @biconomy/bundler
```

## configuration

| Key               | Description                                                                                                                                 |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| bundlerUrl        | Represent ERC4337 spec implemented bundler url. you can get one from biconomy dashboard. Alternatively you can supply any of your preferred |
| chainId           | This represents the network your smart wallet transactions will be conducted on. Take a look following Link for supported chain id's        |
| entryPointAddress | Since entrypoint can have different addresses you can call getSupportedEntryPoints() on bundler instance for supported addresses list       |

```typescript
// This is how you create bundler instance in your dapp's
import { IBundler, Bundler } from "@biconomy/bundler";

// Make use of core-types package
import { ChainId } from "@biconomy/core-types";

const bundler: IBundler = new Bundler({
  bundlerUrl: "",
  chainId: ChainId.POLYGON_MAINNET,
  entryPointAddress: "",
});
```

Following are the methods that can be call on bundler instance

```typescript
export interface IBundler {
  estimateUserOpGas(userOp: Partial<UserOperation>): Promise<UserOpGasResponse>;
  sendUserOp(userOp: UserOperation): Promise<UserOpResponse>;
  getUserOpReceipt(userOpHash: string): Promise<UserOpReceipt>;
  getUserOpByHash(userOpHash: string): Promise<UserOpByHashResponse>;
}
```

**estimateUserOpGas**
Estimate the gas values for a UserOperation. Given UserOperation optionally without gas limits and gas prices, return the needed gas limits. The signature field is ignored by the wallet, so that the operation will not require user's approval. Still, it might require putting a "semi-valid" signature (e.g. a signature in the right length)

**Return Values**

**preVerificationGas** gas overhead of this UserOperation
**verificationGasLimit** actual gas used by the validation of this UserOperation
**callGasLimit** limit used to execute userop.callData called from EntryPoint to the Smart Account

                  --------------------------------

**sendUserOp**
it submits a User Operation object to the User Operation pool of the client. The client MUST validate the UserOperation, and return a result accordingly.

The result SHOULD be set to the userOpHash if and only if the request passed simulation and was accepted in the client's User Operation pool. If the validation, simulation, or User Operation pool inclusion fails, result SHOULD NOT be returned. Rather, the client SHOULD return the failure reason.

**Return Values**
If the UserOperation is valid, the client MUST return the calculated userOpHash for it

                  --------------------------------

**getUserOpByHash**
Return a UserOperation based on a hash (userOpHash) returned by sendUserOp (eth_sendUserOperation)

**Return Values**

null in case the UserOperation is not yet included in a block, or a full UserOperation, with the addition of entryPoint, blockNumber, blockHash and transactionHash

                  --------------------------------

**getUserOpReceipt**

Return a UserOperation receipt based on a hash (userOpHash) returned by eth_sendUserOperation

**Return Values**
null in case the UserOperation is not yet included in a block, or:

**userOpHash** the request hash
**entryPoint**
**sender**
**nonce**
**paymaster** the paymaster used for this userOp (or empty)
**actualGasCost** - actual amount paid (by account or paymaster) for this UserOperation
**actualGasUsed** - total gas used by this UserOperation (including preVerification, creation, validation and execution)
**success** boolean - did this execution completed without revert
**reason** in case of revert, this is the revert reason
**logs** the logs generated by this UserOperation (not including logs of other UserOperations in the same bundle)
**receipt** the TransactionReceipt object. Note that the returned TransactionReceipt is for the entire bundle, not only for this UserOperation.

                  --------------------------------
